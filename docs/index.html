<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ctsmTMB is an R package for parameter and state estimation and forecasting in (multi-dimensional) stochastic state space systems. These are partially observed systems whose latent states evolve according to a set of stochastic differential equations. The package employs the R6 object oriented class for user-friendly model construction, and is based on the TMB/RTMB packages which provides many convenient features for likelihood estimation, in addition to algorithmic differentiation. The estimation methods implemented are variations of Kalman Filters, in addition to a filtering scheme based on the Laplace approximation, the latter of which is enabled by TMB/RTMB.">
<title>Continuous Time Stochastic Modelling using Template Model Builder • ctsmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Mukta-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Continuous Time Stochastic Modelling using Template Model Builder">
<meta property="og:description" content="ctsmTMB is an R package for parameter and state estimation and forecasting in (multi-dimensional) stochastic state space systems. These are partially observed systems whose latent states evolve according to a set of stochastic differential equations. The package employs the R6 object oriented class for user-friendly model construction, and is based on the TMB/RTMB packages which provides many convenient features for likelihood estimation, in addition to algorithmic differentiation. The estimation methods implemented are variations of Kalman Filters, in addition to a filtering scheme based on the Laplace approximation, the latter of which is enabled by TMB/RTMB.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ctsmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/ctsmTMB.html">Getting Started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="articles/estimate.html">Estimation</a>
    <a class="dropdown-item" href="articles/predict.html">Prediction</a>
    <a class="dropdown-item" href="articles/simulate.html">Simulation</a>
    <a class="dropdown-item" href="articles/using_another_optimizer.html">Likelihood (Extracting Function Handlers)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-math-details">Math Details</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-math-details">
    <a class="dropdown-item" href="articles/linear_kalman_filter.html">Linear Kalman Filter</a>
    <a class="dropdown-item" href="articles/extended_kalman_filter.html">Extended Kalman Filter</a>
    <a class="dropdown-item" href="articles/unscented_kalman_filter.html">Unscented Kalman Filter</a>
    <a class="dropdown-item" href="articles/laplace_approx.html">Laplace "Filter"</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phillipbvetter/ctsmTMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="ctsmtmb-">ctsmTMB <a class="anchor" aria-label="anchor" href="#ctsmtmb-"></a>
</h1>
</div>
<!-- Badges -->
<!-- [![CRAN status](https://www.r-pkg.org/badges/version/geomtextpath)](https://CRAN.R-project.org/package=geomtextpath) -->
<p><a href="https://github.com/phillipbvetter/ctsmTMB/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/phillipbvetter/ctsmTMB/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <!-- [![metacran downloads](https://cranlogs.r-pkg.org/badges/geomtextpath)](https://cran.r-project.org/package=geomtextpath) --> <!-- Package Description --></p>
</div>
<div class="section level1">
<h1 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h1>
<p>Welcome to this GitHub repository which hosts <strong>ctsmTMB</strong> <a href="https://phillipbvetter.github.io/ctsmTMB/index.html" class="external-link">(Continuous Time Stochastic Modelling using Template Model Builder)</a>, the intended successor of, and heavily inspired by, the <strong>CTSM</strong> package <a href="https://ctsm.info" class="external-link">(Continuous Time Stochastic Modelling)</a>. The purpose of the package is to facilitate a user-friendly tool for (state and parameter) inference, and forecasting, in (multi-dimensional) continuous-discrete stochastic state space systems, i.e. systems on the form</p>
<!-- $$ -->
<!-- \begin{align} -->
<!-- dx_{t} & = f(t, x_t, u_t, \theta) \, dt + g(t, x_t, u_t, \theta) \, dB_{t} \\ -->
<!-- y_{t_k} & = h(t, x_t, u_t, \theta) -->
<!-- \end{align} -->
<!-- $$ -->
<p><span class="math display"><em>d</em><em>x</em><sub><em>t</em></sub> = <em>f</em>(<em>t</em>, <em>x</em><sub><em>t</em></sub>, <em>u</em><sub><em>t</em></sub>, <em>θ</em>) <em>d</em><em>t</em> + <em>g</em>(<em>t</em>, <em>x</em><sub><em>t</em></sub>, <em>u</em><sub><em>t</em></sub>, <em>θ</em>) <em>d</em><em>B</em><sub><em>t</em></sub></span> <span class="math display"><em>y</em><sub><em>t</em><sub><em>k</em></sub></sub> = <em>h</em>(<em>t</em><sub><em>k</em></sub>, <em>x</em><sub><em>t</em><sub><em>k</em></sub></sub>, <em>u</em><sub><em>t</em><sub><em>k</em></sub></sub>, <em>θ</em>)</span></p>
<p>Here the latent state <span class="math inline"><em>x</em><sub><em>t</em></sub></span> evolves continuously in time, governed by a set of stochastic differential equations, and information about the system is available at discrete times through the observations <span class="math inline"><em>y</em><sub><em>t</em><sub><em>k</em></sub></sub></span>.</p>
<p>The <strong>ctsmTMB</strong> package is essentially wrapper around the <strong>TMB/RTMB</strong> packages <a href="https://github.com/kaskr/adcomp" class="external-link">(Template Model Builder)</a> that provide automatic differentiation of the likelihood function, and access to other computational tools such as the Laplace approximation. The likelihood function is constructed based on the (symbolic) user-provided state space equations, which may be specified using the implemented OOP-style <strong>R6</strong> <code>ctsmTMB</code> class, with methods such as <code>addSystem</code> (for defining system equations), and <code>addObs</code> (for defining observation equations).</p>
<p>The primary work-horse of <strong>ctsmTMB</strong> is the <code>estimate</code> method, which carries out inference by minimizing the (negative log) likelihood using the <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb</a></code> quasi-Newton optimizer due to <a href="https://dl.acm.org/doi/pdf/10.1145/355958.355965" class="external-link">D. Gay</a>. The resulting object contains the maximum likelihood parameter and state estimates, and associated marginal uncertainties. The available inference methods are the Linear and Extended Kalman filters in addition to filtration (actually smoothing) using a Laplace approximation approach. <!-- The user can extract the likelihood function handles (function, gradient and hessian) with the `likelihood` method if e.g. they want to use another optimizer. --></p>
<p>The package facilities forecasting through the <code>predict</code> (moment forecasts) and <code>simulate</code> (stochastic path simulations) methods. The calculations for these may be carried out in either <strong>R</strong> (default) or for additional speed in <strong>C++</strong> using <code>Rcpp</code>. <!-- in particular using the `RcppXPtrUtils` package for sending **C++** pointers of the model-specific functions (drift, diffusion, observation and jacobians) rather than sending (slow to evaluate) **R** functions. --></p>
<!-- Estimation Methods -->
</div>
<div class="section level1">
<h1 id="estimation-methods">Estimation Methods<a class="anchor" aria-label="anchor" href="#estimation-methods"></a>
</h1>
<p>The following state reconstruction algorithms are currently available:</p>
<ol style="list-style-type: decimal">
<li><p>The (Continous-Discrete) Linear Kalman Filter, <code>lkf</code>.</p></li>
<li><p>The (Continous-Discrete) Extended Kalman Filter, <code>ekf</code>.</p></li>
<li><p>The (Continuous-Discrete) Laplace “Filter” <code>laplace</code>.</p></li>
</ol>
<div class="section level2">
<h2 id="kalman-filters">Kalman Filters<a class="anchor" aria-label="anchor" href="#kalman-filters"></a>
</h2>
<p>The package is currently mostly tailored towards the Kalman Filter. The advantages of the methods are:</p>
<ol style="list-style-type: decimal">
<li><p>The hessian of the likelihood function (w.r.t parameters) is available.</p></li>
<li><p>The model residuals are easier to compute for e.g. model validation.</p></li>
<li><p>Multi-step predictions / simulations with state updates are easier to compute.</p></li>
</ol>
<p>In these cases <strong>TMB</strong> simply provides the automatic differentiation.</p>
<!-- The Unscented Kalman Filter implementation is based on *Algorithm 4.7* in [S. Särkkä, 2007](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=4303242). -->
</div>
<div class="section level2">
<h2 id="laplace-filter">Laplace “Filter”<a class="anchor" aria-label="anchor" href="#laplace-filter"></a>
</h2>
<p>The state-reconstructions based on the <code>laplace</code> (approximation) method are <em>smoothed</em> estimates, meaning that all states are optimized jointly, given all observations in the data. The Laplace Approximation is natively built-into and completely handled by <strong>TMB</strong>. The package implements the stability-improved method due to <a href="https://arxiv.org/abs/2503.21358" class="external-link">Thygesen, 2025</a>.</p>
<p>A particular advantage of Laplace filter is:</p>
<ol style="list-style-type: decimal">
<li>The possibility for unimodal non-Gaussian observation densities to accommodate the need for e.g. heavier distribution tails. Not implemented.</li>
</ol>
<p>The method is typically not useful for model-training with the goal of forecasting because the likelihood contributions are based on smoothed estimates, rather than the one-step predictions of Kalman filters.</p>
<!-- Installation -->
</div>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>You can install the package by copying the command below into <code>R</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span>repo<span class="op">=</span><span class="st">"phillipbvetter/ctsmTMB"</span>, dependencies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>It is important to note that users must have working C++ compilers to install and use <strong>ctsmTMB</strong>.</p>
<div class="section level2">
<h2 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h2>
<p>C++ compilation in R requires <strong>Rtools</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Go to <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/</a> and find the latest version.</p></li>
<li><p>Go to “Control Panel -&gt; System -&gt;”Advanced” (tab) -&gt; “Environment Variables” -&gt; Highlight “Path” -&gt; “Edit” -&gt; Add to the character string in “Variable Value” the path to your Rtools folder **C:;C:*.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="mac--unix">Mac / Unix<a class="anchor" aria-label="anchor" href="#mac--unix"></a>
</h2>
<p>Mac users should install <em>Command Line Tools</em>. Run the following command in the Terminal</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">xcode-select</span> <span class="at">--install</span></span></code></pre></div>
<!---
Linux also need to make sure that GSL is installed for `RcppZiggurat` which is necessary for the `simulate` method. You can try the following command, or google yourself.
&#10;
``` bash
sudo apt-get install libgsl-dev
```
--->
</div>
<div class="section level2">
<h2 id="test-the-installation">Test the Installation<a class="anchor" aria-label="anchor" href="#test-the-installation"></a>
</h2>
<p>Once you have installed the package is it a good idea to test whether <strong>TMB</strong> and C++ compilation works. You should be able to run all examples without compilation errors:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/adcomp/wiki" class="external-link">TMB</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/runExample.html" class="external-link">runExample</a></span><span class="op">(</span>all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>For further information see the <a href="https://github.com/kaskr/adcomp" class="external-link">TMB GitHub</a> and its associated <a href="https://github.com/kaskr/adcomp/wiki/Download" class="external-link">installation instructions</a>.</p>
</div>
</div>
<div class="section level1">
<h1 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h1>
<p>You can visit the package <a href="https://phillipbvetter.github.io/ctsmTMB/index.html" class="external-link">webpage</a> and browse the vignettes for example uses, in particular see <a href="https://phillipbvetter.github.io/ctsmTMB/articles/ctsmTMB.html" class="external-link">Getting Started</a>.</p>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>You can access the documentation for all methods with</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ctsmTMB</span></span></code></pre></div>
<p>or invidually using the standard syntax</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">ctsmTMB</span><span class="fu">::</span><span class="va"><a href="reference/addSystem.html">addSystem</a></span></span>
<span><span class="op">?</span><span class="fu">ctsmTMB</span><span class="fu">::</span><span class="va">estimate</span></span></code></pre></div>
<p>The methods documentation is also available on the <a href="https://phillipbvetter.github.io/ctsmTMB/reference/ctsmTMB.html" class="external-link">package homepage</a>.</p>
</div>
<div class="section level2">
<h2 id="code-example---inference-in-1d-ornstein-uhlenbeck-process">Code Example - Inference in 1D Ornstein-Uhlenbeck Process<a class="anchor" aria-label="anchor" href="#code-example---inference-in-1d-ornstein-uhlenbeck-process"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/phillipbvetter/ctsmTMB" class="external-link">ctsmTMB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">############################################################</span></span>
<span><span class="co"># Data simulation</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="co"># Simulate data using Euler Maruyama</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fl">10</span>, mu<span class="op">=</span><span class="fl">1</span>, sigma_x<span class="op">=</span><span class="fl">1</span>, sigma_y<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="va">dt.sim</span> <span class="op">=</span> <span class="fl">1e-3</span></span>
<span><span class="va">t.sim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,by<span class="op">=</span><span class="va">dt.sim</span><span class="op">)</span></span>
<span><span class="va">dw</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.sim</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">dt.sim</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">u.sim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.sim</span><span class="op">)</span>,sd<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.sim</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">u.sim</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">dt.sim</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">dw</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Extract observations and add noise</span></span>
<span><span class="va">dt.obs</span> <span class="op">=</span> <span class="fl">1e-2</span></span>
<span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.sim</span><span class="op">)</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">dt.obs</span> <span class="op">/</span> <span class="va">dt.sim</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t.obs</span> <span class="op">=</span> <span class="va">t.sim</span><span class="op">[</span><span class="va">ids</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">ids</span><span class="op">]</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># forcing input</span></span>
<span><span class="va">u</span> <span class="op">=</span> <span class="va">u.sim</span><span class="op">[</span><span class="va">ids</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create data</span></span>
<span><span class="va">.data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t.obs</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  u <span class="op">=</span> <span class="va">u</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">############################################################</span></span>
<span><span class="co"># Model creation and estimation</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="co"># Create model object</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="va"><a href="reference/ctsmTMB.html">ctsmTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add system equations</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">addSystem</span><span class="op">(</span></span>
<span>  <span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span><span class="op">-</span><span class="va">x</span><span class="op">+</span><span class="va">u</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma_x</span><span class="op">*</span><span class="va">dw</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add observation equations</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">addObs</span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set observation equation variances</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">setVariance</span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">sigma_y</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add vector input</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">addInput</span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify parameter initial values and lower/upper bounds in estimation</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span></span>
<span>  theta   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1</span>, lower<span class="op">=</span><span class="fl">1e-5</span>, upper<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>  mu      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">1.5</span>, lower<span class="op">=</span><span class="fl">0</span>, upper<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  sigma_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">1</span>, lower<span class="op">=</span><span class="fl">1e-10</span>, upper<span class="op">=</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>  sigma_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">1e-1</span>, lower<span class="op">=</span><span class="fl">1e-10</span>, upper<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial state mean and covariance</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">setInitialState</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1e-1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Carry out estimation with default settings (extended kalman filter)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span>data<span class="op">=</span><span class="va">.data</span>, method<span class="op">=</span><span class="st">"ekf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check parameter estimates against truth</span></span>
<span><span class="va">p0</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">par.fixed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">p0</span>,<span class="va">pars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plot of one-step predictions, simulated states and observations</span></span>
<span><span class="va">t.est</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">prior</span><span class="op">$</span><span class="va">t</span></span>
<span><span class="va">x.mean</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">prior</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">x.sd</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">sd</span><span class="op">$</span><span class="va">prior</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">plot1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.est</span>, ymin<span class="op">=</span><span class="va">x.mean</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">x.sd</span>, ymax<span class="op">=</span><span class="va">x.mean</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">x.sd</span><span class="op">)</span>,fill<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.est</span>, <span class="va">x.mean</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.sim</span>,y<span class="op">=</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.obs</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"tomato"</span>,size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"1-Step State Estimates vs Observations"</span>, x<span class="op">=</span><span class="st">"Time"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict to obtain k-step-ahead predictions to see model forecasting ability</span></span>
<span><span class="va">pred.list</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span>data<span class="op">=</span><span class="va">.data</span>, </span>
<span>                          k.ahead<span class="op">=</span><span class="fl">10</span>, </span>
<span>                          method<span class="op">=</span><span class="st">"ekf"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plot all 10-step predictions against data</span></span>
<span><span class="va">pred</span> <span class="op">=</span> <span class="va">pred.list</span><span class="op">$</span><span class="va">states</span></span>
<span><span class="va">pred10step</span> <span class="op">=</span> <span class="va">pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">k.ahead</span><span class="op">==</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">plot2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pred10step</span><span class="op">$</span><span class="va">t.j</span>, </span>
<span>                  ymin<span class="op">=</span><span class="va">pred10step</span><span class="op">$</span><span class="va">x</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">pred10step</span><span class="op">$</span><span class="va">var.x</span><span class="op">)</span>,</span>
<span>                  ymax<span class="op">=</span><span class="va">pred10step</span><span class="op">$</span><span class="va">x</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">pred10step</span><span class="op">$</span><span class="va">var.x</span><span class="op">)</span><span class="op">)</span>,fill<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pred10step</span><span class="op">$</span><span class="va">t.j</span>,<span class="va">pred10step</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"steelblue"</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.obs</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"tomato"</span>,size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"10 Step Predictions vs Observations"</span>, x<span class="op">=</span><span class="st">"Time"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform prediction ignoring all data</span></span>
<span><span class="va">pred.list</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span>data<span class="op">=</span><span class="va">.data</span>,method<span class="op">=</span><span class="st">"ekf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform simulation ignoring all data</span></span>
<span><span class="va">sim.list</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>data<span class="op">=</span><span class="va">.data</span>, method<span class="op">=</span><span class="st">"ekf"</span>, n.sims<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collapse simulation data for easy use with ggplot </span></span>
<span><span class="va">sim.df</span> <span class="op">=</span> <span class="va">sim.list</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">i0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"i"</span>,<span class="st">"j"</span>,<span class="st">"t.i"</span>,<span class="st">"k.ahead"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">.</span>, id.var<span class="op">=</span><span class="st">"t.j"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot all simulations and the prediction against observations</span></span>
<span><span class="va">plot3</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim.df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.j</span>, y<span class="op">=</span><span class="va">value</span>, group<span class="op">=</span><span class="va">variable</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pred.list</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">t.j</span>,y<span class="op">=</span><span class="va">pred.list</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.obs</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"tomato"</span>,size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"No Update Prediction and Simulations vs Observations"</span>, x<span class="op">=</span><span class="st">"Time"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plot</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span>, <span class="va">plot3</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create one-step-ahead residual analysis plot</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrap both plots</span></span>
<span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<ul>
<li>U. H. Thygesen and K. Kristensen (2025), <em>“Inference in stochastic differential equations using the Laplace approximation: Demonstration and examples”</em>. In: <a href="https://arxiv.org/abs/2503.21358" class="external-link">arXiv:2503.21358v2</a>.</li>
</ul>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/phillipbvetter/ctsmTMB/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/phillipbvetter/ctsmTMB/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ctsmTMB</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Phillip Vetter <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9290-7942" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
